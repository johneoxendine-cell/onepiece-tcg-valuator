[build]
builder = "nixpacks"

[build.commands]
install = "npm install --prefix backend && npm install --prefix frontend --include=dev"
build = "npm run build --prefix frontend"

[deploy]
startCommand = "npm start --prefix backend"
healthcheckPath = "/api/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[env]
NODE_ENV = "production"
